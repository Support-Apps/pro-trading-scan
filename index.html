<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TradeScan Pro</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #0B0E11;
            --card: #1a1d21;
            --border: rgba(255,255,255,0.08);
            --gold: #F0B90B;
            --green: #0ECB81;
            --red: #F6465D;
            --text: #EAECEF;
            --dim: #848E9C;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
        
        .intro-page { min-height: 100vh; padding: 20px; padding-bottom: 100px; }
        .intro-page.hidden { display: none; }
        .intro-header { text-align: center; padding: 30px 0 20px; }
        .intro-logo { width: 80px; height: 80px; margin: 0 auto 16px; background: linear-gradient(135deg, var(--gold), #D4A017); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 36px; }
        .intro-header h1 { font-size: 1.8em; font-weight: 800; color: var(--gold); }
        .intro-header p { color: var(--dim); font-size: 0.9em; margin-top: 4px; }
        .intro-card { background: var(--card); border-radius: 16px; padding: 20px; margin-bottom: 12px; border: 1px solid var(--border); }
        .intro-card h3 { font-size: 1em; margin-bottom: 12px; }
        .intro-card p { color: var(--dim); font-size: 0.85em; line-height: 1.6; }
        .pattern-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 10px; }
        .tag { padding: 6px 10px; border-radius: 8px; font-size: 0.75em; font-weight: 600; }
        .tag.green { background: rgba(14,203,129,0.15); color: var(--green); }
        .tag.red { background: rgba(246,70,93,0.15); color: var(--red); }
        .tag.gold { background: rgba(240,185,11,0.15); color: var(--gold); }
        .disclaimer { background: rgba(246,70,93,0.08); border: 1px solid rgba(246,70,93,0.2); border-radius: 12px; padding: 14px; }
        .disclaimer p { font-size: 0.8em; color: var(--dim); }
        .intro-btn-wrap { position: fixed; bottom: 0; left: 0; right: 0; padding: 16px 20px 28px; background: linear-gradient(0deg, var(--bg) 70%, transparent); }
        .intro-btn { width: 100%; padding: 16px; border: none; border-radius: 14px; font-size: 1em; font-weight: 700; cursor: pointer; background: linear-gradient(135deg, var(--gold), #D4A017); color: #000; }
        
        .scanner-page { display: none; height: 100vh; flex-direction: column; overflow: hidden; }
        .scanner-page.active { display: flex; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 10px 14px; background: var(--card); border-bottom: 1px solid var(--border); }
        .logo-sm { display: flex; align-items: center; gap: 8px; font-weight: 700; }
        .logo-sm .icon { width: 28px; height: 28px; background: var(--gold); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 11px; color: #000; font-weight: 800; }
        .logo-sm span { color: var(--gold); }
        .back-btn { background: transparent; border: 1px solid var(--border); color: var(--dim); padding: 6px 12px; border-radius: 8px; font-size: 0.8em; cursor: pointer; }
        
        .camera-area { position: relative; margin: 8px; border-radius: 14px; overflow: hidden; background: #000; aspect-ratio: 16/9; border: 2px solid var(--border); }
        #video { width: 100%; height: 100%; object-fit: cover; display: none; }
        #video.active { display: block; }
        #canvas { display: none; }
        .cam-placeholder { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, #12151a, #0a0c0f); }
        .cam-placeholder.hidden { display: none; }
        .cam-placeholder .icon { font-size: 32px; margin-bottom: 8px; }
        .cam-placeholder p { color: var(--dim); font-size: 0.85em; }
        .scan-overlay { position: absolute; inset: 0; pointer-events: none; display: none; }
        .scan-overlay.active { display: block; }
        .scan-frame { position: absolute; top: 5%; left: 3%; right: 3%; bottom: 5%; border: 2px solid rgba(240,185,11,0.4); border-radius: 10px; }
        .scan-line { position: absolute; left: 3%; right: 3%; height: 2px; background: linear-gradient(90deg, transparent, var(--gold), transparent); box-shadow: 0 0 15px var(--gold); animation: scanMove 2s ease-in-out infinite; }
        @keyframes scanMove { 0%, 100% { top: 8%; } 50% { top: 90%; } }
        .live-badge { position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); padding: 4px 10px; border-radius: 6px; font-size: 0.7em; color: var(--red); display: none; }
        .live-badge.active { display: block; }
        
        .data-panel { flex: 1; padding: 8px; display: flex; flex-direction: column; gap: 8px; overflow-y: auto; }
        .signal-card { background: var(--card); border-radius: 12px; padding: 12px; border: 1px solid var(--border); display: flex; align-items: center; gap: 12px; }
        .signal-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .signal-icon.bullish { background: rgba(14,203,129,0.15); }
        .signal-icon.bearish { background: rgba(246,70,93,0.15); }
        .signal-icon.neutral { background: rgba(240,185,11,0.15); }
        .signal-info { flex: 1; }
        .signal-info .direction { font-size: 1.15em; font-weight: 800; }
        .signal-info .direction.bullish { color: var(--green); }
        .signal-info .direction.bearish { color: var(--red); }
        .signal-info .direction.neutral { color: var(--gold); }
        .signal-info .meta { font-size: 0.75em; color: var(--dim); margin-top: 2px; }
        .signal-conf { text-align: center; }
        .signal-conf .num { font-size: 1.5em; font-weight: 800; }
        .signal-conf .num.bullish { color: var(--green); }
        .signal-conf .num.bearish { color: var(--red); }
        .signal-conf .num.neutral { color: var(--gold); }
        .signal-conf .lbl { font-size: 0.6em; color: var(--dim); }
        
        .prediction { background: var(--card); border-radius: 12px; padding: 12px; border: 1px solid var(--border); display: flex; align-items: center; gap: 10px; }
        .prediction.bullish { border-left: 3px solid var(--green); }
        .prediction.bearish { border-left: 3px solid var(--red); }
        .prediction.neutral { border-left: 3px solid var(--gold); }
        .prediction .icon { font-size: 22px; }
        .prediction .text { flex: 1; }
        .prediction .text strong { font-size: 0.9em; display: block; margin-bottom: 2px; }
        .prediction .text span { font-size: 0.75em; color: var(--dim); }
        .prediction .action { font-size: 0.72em; padding: 6px 10px; border-radius: 8px; font-weight: 700; }
        .prediction .action.buy { background: rgba(14,203,129,0.15); color: var(--green); }
        .prediction .action.sell { background: rgba(246,70,93,0.15); color: var(--red); }
        .prediction .action.wait { background: rgba(240,185,11,0.15); color: var(--gold); }
        
        .patterns-box { background: var(--card); border-radius: 12px; padding: 10px; border: 1px solid var(--border); }
        .patterns-header { display: flex; justify-content: space-between; font-size: 0.75em; color: var(--dim); margin-bottom: 8px; }
        .patterns-chips { display: flex; flex-wrap: wrap; gap: 6px; }
        .pat-chip { display: flex; align-items: center; gap: 5px; padding: 7px 11px; border-radius: 8px; font-size: 0.78em; font-weight: 600; }
        .pat-chip.bullish { background: rgba(14,203,129,0.12); color: var(--green); }
        .pat-chip.bearish { background: rgba(246,70,93,0.12); color: var(--red); }
        .pat-chip.neutral { background: rgba(240,185,11,0.12); color: var(--gold); }
        .no-patterns { text-align: center; padding: 15px; color: var(--dim); font-size: 0.85em; }
        
        .empty-state { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; color: var(--dim); padding: 20px; }
        .empty-state .icon { font-size: 36px; margin-bottom: 10px; }
        .empty-state p { font-size: 0.85em; line-height: 1.5; }
        
        .scan-btn-area { padding: 8px 8px 20px; }
        .scan-btn { width: 100%; padding: 14px; border: none; border-radius: 12px; font-size: 1em; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .scan-btn.start { background: linear-gradient(135deg, var(--green), #00B37D); color: #fff; }
        .scan-btn.stop { background: linear-gradient(135deg, var(--red), #D63850); color: #fff; }
    </style>
</head>
<body>
    <div class="intro-page" id="introPage">
        <div class="intro-header">
            <div class="intro-logo">üìà</div>
            <h1>TradeScan Pro</h1>
            <p>AI Candlestick Pattern Scanner</p>
        </div>
        <div class="intro-card">
            <h3>üéØ Real-Time Chart Analysis</h3>
            <p>Point your camera at any candlestick chart. AI detects patterns and predicts the next market direction instantly.</p>
        </div>
        <div class="intro-card">
            <h3>üïØÔ∏è Detected Patterns</h3>
            <p>The scanner recognizes these Japanese candlestick patterns:</p>
            <div class="pattern-tags">
                <span class="tag green">üî® Hammer</span>
                <span class="tag green">ü´Ç Bullish Engulfing</span>
                <span class="tag green">‚≠ê Morning Star</span>
                <span class="tag green">üë®‚Äçüë®‚Äçüë¶ 3 White Soldiers</span>
                <span class="tag red">üí´ Shooting Star</span>
                <span class="tag red">ü´Ç Bearish Engulfing</span>
                <span class="tag red">üåô Evening Star</span>
                <span class="tag red">üê¶‚Äç‚¨õ 3 Black Crows</span>
                <span class="tag gold">‚ûï Doji</span>
            </div>
        </div>
        <div class="intro-card">
            <h3>üìä How It Works</h3>
            <p><strong>1.</strong> Point camera at a candlestick chart (TradingView, MT4, etc.)</p>
            <p><strong>2.</strong> The AI scans for green and red candles</p>
            <p><strong>3.</strong> Analyzes the last 10 candles for trend direction</p>
            <p><strong>4.</strong> Detects patterns in the last 5 candles</p>
            <p><strong>5.</strong> Predicts the next likely market move</p>
        </div>
        <div class="intro-card">
            <h3>üìö Pattern Meanings</h3>
            <p><strong>3 White Soldiers</strong> - 3 consecutive green candles rising. Strong bullish signal - price likely to continue up.</p>
            <p style="margin-top:8px"><strong>3 Black Crows</strong> - 3 consecutive red candles falling. Strong bearish signal - price likely to continue down.</p>
            <p style="margin-top:8px"><strong>Engulfing</strong> - Current candle completely covers previous one. Signals trend reversal.</p>
            <p style="margin-top:8px"><strong>Morning/Evening Star</strong> - 3-candle reversal pattern at bottom/top of trend.</p>
        </div>
        <div class="disclaimer">
            <p>‚ö†Ô∏è <strong>Risk Warning:</strong> This is an educational tool only. Pattern recognition is ONE factor in trading decisions. Always use stop-losses, manage risk, and never trade money you can't afford to lose.</p>
        </div>
        <div class="intro-btn-wrap">
            <button class="intro-btn" onclick="showScanner()">‚Üí Open Scanner</button>
        </div>
    </div>
    
    <div class="scanner-page" id="scannerPage">
        <div class="top-bar">
            <div class="logo-sm">
                <div class="icon">TS</div>
                Trade<span>Scan</span>
            </div>
            <button class="back-btn" onclick="showIntro()">‚Üê Back</button>
        </div>
        <div class="camera-area">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas"></canvas>
            <div class="cam-placeholder" id="placeholder">
                <div class="icon">üì∑</div>
                <p>Camera ready</p>
            </div>
            <div class="scan-overlay" id="overlay">
                <div class="scan-frame"></div>
                <div class="scan-line"></div>
            </div>
            <div class="live-badge" id="liveBadge">‚óè LIVE</div>
        </div>
        <div class="data-panel" id="dataPanel">
            <div class="empty-state">
                <div class="icon">üîç</div>
                <p>Point camera at candlestick chart<br>and tap Start Scanning</p>
            </div>
        </div>
        <div class="scan-btn-area">
            <button class="scan-btn start" id="scanBtn" onclick="toggleScan()">
                <span id="btnIcon">‚ñ∂</span>
                <span id="btnText">Start Scanning</span>
            </button>
        </div>
    </div>

<script>
var scanning = false;
var stream = null;
var animId = null;
var video, canvas, ctx, placeholder, overlay, dataPanel, liveBadge, scanBtn, btnIcon, btnText;

function showScanner() {
    document.getElementById('introPage').classList.add('hidden');
    document.getElementById('scannerPage').classList.add('active');
}

function showIntro() {
    stopScan();
    document.getElementById('scannerPage').classList.remove('active');
    document.getElementById('introPage').classList.remove('hidden');
}

document.addEventListener('DOMContentLoaded', function() {
    video = document.getElementById('video');
    canvas = document.getElementById('canvas');
    ctx = canvas.getContext('2d', { willReadFrequently: true });
    placeholder = document.getElementById('placeholder');
    overlay = document.getElementById('overlay');
    dataPanel = document.getElementById('dataPanel');
    liveBadge = document.getElementById('liveBadge');
    scanBtn = document.getElementById('scanBtn');
    btnIcon = document.getElementById('btnIcon');
    btnText = document.getElementById('btnText');
});

function toggleScan() {
    if (scanning) stopScan();
    else startScan();
}

function startScan() {
    navigator.mediaDevices.getUserMedia({
        video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } }
    }).then(function(s) {
        stream = s;
        video.srcObject = stream;
        video.classList.add('active');
        video.onloadedmetadata = function() {
            scanning = true;
            placeholder.classList.add('hidden');
            overlay.classList.add('active');
            liveBadge.classList.add('active');
            scanBtn.className = 'scan-btn stop';
            btnIcon.textContent = '‚èπ';
            btnText.textContent = 'Stop Scanning';
            animId = requestAnimationFrame(analyzeLoop);
        };
    }).catch(function(e) {
        alert('Camera error: ' + e.message);
    });
}

function stopScan() {
    scanning = false;
    if (animId) cancelAnimationFrame(animId);
    if (stream) stream.getTracks().forEach(function(t) { t.stop(); });
    video.srcObject = null;
    video.classList.remove('active');
    placeholder.classList.remove('hidden');
    overlay.classList.remove('active');
    liveBadge.classList.remove('active');
    scanBtn.className = 'scan-btn start';
    btnIcon.textContent = '‚ñ∂';
    btnText.textContent = 'Start Scanning';
}

var frameCount = 0;
function analyzeLoop() {
    if (!scanning) return;
    frameCount++;
    if (frameCount % 5 === 0) doAnalysis();
    animId = requestAnimationFrame(analyzeLoop);
}

function doAnalysis() {
    if (!video.videoWidth) return;
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0);
    var imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    var candles = detectCandles(imgData);
    
    if (candles.length >= 3) {
        var result = analyzeCandles(candles);
        renderResults(result);
    } else {
        dataPanel.innerHTML = '<div class="empty-state"><div class="icon">üîç</div><p>Looking for candles...<br>Point camera at chart</p></div>';
    }
}

// ===================== CANDLE DETECTION =====================
function detectCandles(imgData) {
    var data = imgData.data;
    var w = imgData.width;
    var h = imgData.height;
    
    var top = Math.floor(h * 0.08);
    var bot = Math.floor(h * 0.88);
    var left = Math.floor(w * 0.05);
    var right = Math.floor(w * 0.95);
    var scanH = bot - top;
    var scanW = right - left;
    
    var columns = [];
    var step = Math.max(1, Math.floor(scanW / 250));
    
    for (var x = left; x < right; x += step) {
        var greenPx = 0, redPx = 0;
        var greenTop = bot, greenBot = top;
        var redTop = bot, redBot = top;
        
        for (var y = top; y < bot; y++) {
            var i = (y * w + x) * 4;
            var r = data[i], g = data[i+1], b = data[i+2];
            var brightness = (r + g + b) / 3;
            
            // Skip white/black
            if (brightness > 240 || brightness < 20) continue;
            
            // ===== GREEN/TEAL DETECTION =====
            // TradingView teal: rgb(38, 166, 154)
            // Key: G is high, B is also high, R is low
            var isGreen = false;
            
            // Teal: G and B both much higher than R
            if (g > r + 30 && b > r + 20 && g > 100) isGreen = true;
            
            // Standard green: G dominant
            if (g > r + 40 && g > b + 20 && g > 100) isGreen = true;
            
            // Bright green/lime
            if (g > 150 && g > r * 2 && g > b) isGreen = true;
            
            // Cyan-green
            if (g > 120 && b > 100 && r < 80 && g >= b * 0.8) isGreen = true;
            
            // ===== RED DETECTION =====
            // TradingView red: rgb(239, 83, 80)
            // Key: R is very high, G and B are low
            var isRed = false;
            
            // Standard red: R much higher than G and B
            if (r > g + 50 && r > b + 50 && r > 120) isRed = true;
            
            // Coral/salmon red
            if (r > 180 && r > g * 1.8 && r > b * 1.8) isRed = true;
            
            // Dark red
            if (r > 100 && r > g * 2 && r > b * 2 && g < 100) isRed = true;
            
            // Resolve conflict
            if (isGreen && isRed) {
                if ((g + b) - r > r - (g + b) / 2) isRed = false;
                else isGreen = false;
            }
            
            if (isGreen) {
                greenPx++;
                if (y < greenTop) greenTop = y;
                if (y > greenBot) greenBot = y;
            }
            if (isRed) {
                redPx++;
                if (y < redTop) redTop = y;
                if (y > redBot) redBot = y;
            }
        }
        
        var minPx = Math.floor(scanH * 0.008);
        if (greenPx > minPx && greenPx > redPx * 1.2) {
            columns.push({ x: x, type: 'green', top: greenTop, bot: greenBot });
        } else if (redPx > minPx && redPx > greenPx * 1.2) {
            columns.push({ x: x, type: 'red', top: redTop, bot: redBot });
        }
    }
    
    // Group columns into candles
    var candles = [];
    if (columns.length === 0) return candles;
    
    var cur = { x: columns[0].x, type: columns[0].type, top: columns[0].top, bot: columns[0].bot, n: 1 };
    var minGap = Math.max(2, Math.floor(scanW / 80));
    
    for (var i = 1; i < columns.length; i++) {
        var c = columns[i];
        var gap = c.x - cur.x;
        
        if (gap < minGap && c.type === cur.type) {
            cur.top = Math.min(cur.top, c.top);
            cur.bot = Math.max(cur.bot, c.bot);
            cur.n++;
        } else {
            if (cur.n >= 1) candles.push({ type: cur.type, top: cur.top, bot: cur.bot });
            cur = { x: c.x, type: c.type, top: c.top, bot: c.bot, n: 1 };
        }
    }
    if (cur.n >= 1) candles.push({ type: cur.type, top: cur.top, bot: cur.bot });
    
    return candles;
}

// ===================== ANALYZE CANDLES =====================
function analyzeCandles(candles) {
    // Find last trend change
    var trendStart = 0;
    if (candles.length > 5) {
        for (var i = candles.length - 1; i >= 3; i--) {
            var curr = candles[i].type;
            var prev1 = candles[i-1].type;
            var prev2 = candles[i-2].type;
            var prev3 = candles[i-3].type;
            
            // Look for trend change: 3 same color followed by different
            if (prev1 === prev2 && prev2 === prev3 && curr !== prev1) {
                trendStart = i;
                break;
            }
        }
    }
    
    // Get candles from trend change to end
    var relevantCandles = candles.slice(trendStart);
    if (relevantCandles.length > 30) relevantCandles = relevantCandles.slice(-30);
    
    // Count colors
    var greenCount = 0, redCount = 0;
    relevantCandles.forEach(function(c) {
        if (c.type === 'green') greenCount++;
        else redCount++;
    });
    
    // Last 5 candles for pattern detection
    var last5 = relevantCandles.slice(-5);
    var patterns = detectPatterns(last5);
    
    // Determine direction
    var dir, conf;
    var total = greenCount + redCount;
    
    if (greenCount > redCount) {
        dir = 'bullish';
        conf = Math.round((greenCount / total) * 100);
    } else if (redCount > greenCount) {
        dir = 'bearish';
        conf = Math.round((redCount / total) * 100);
    } else {
        dir = 'neutral';
        conf = 50;
    }
    
    // Predict next move based on patterns
    var prediction = predictNext(dir, patterns, last5);
    
    return {
        dir: dir,
        conf: Math.min(95, conf),
        greenCount: greenCount,
        redCount: redCount,
        total: relevantCandles.length,
        patterns: patterns,
        prediction: prediction
    };
}

// ===================== PATTERN DETECTION =====================
function detectPatterns(candles) {
    var patterns = [];
    if (candles.length < 2) return patterns;
    
    var last = candles[candles.length - 1];
    var prev = candles[candles.length - 2];
    
    // 3 candle patterns - check last 3 candles
    if (candles.length >= 3) {
        var c1 = candles[candles.length - 3];
        var c2 = candles[candles.length - 2];
        var c3 = candles[candles.length - 1];
        
        // 3 White Soldiers: 3 green candles in a row
        if (c1.type === 'green' && c2.type === 'green' && c3.type === 'green') {
            patterns.push({ name: '3 White Soldiers', type: 'bullish', icon: 'üë®‚Äçüë®‚Äçüë¶' });
        }
        
        // 3 Black Crows: 3 red candles in a row
        if (c1.type === 'red' && c2.type === 'red' && c3.type === 'red') {
            patterns.push({ name: '3 Black Crows', type: 'bearish', icon: 'üê¶‚Äç‚¨õ' });
        }
        
        // Morning Star: red, small, green
        var c2Height = c2.bot - c2.top;
        var c1Height = c1.bot - c1.top;
        var c3Height = c3.bot - c3.top;
        if (c1.type === 'red' && c3.type === 'green' && c2Height < c1Height * 0.5 && c2Height < c3Height * 0.5) {
            patterns.push({ name: 'Morning Star', type: 'bullish', icon: '‚≠ê' });
        }
        
        // Evening Star: green, small, red
        if (c1.type === 'green' && c3.type === 'red' && c2Height < c1Height * 0.5 && c2Height < c3Height * 0.5) {
            patterns.push({ name: 'Evening Star', type: 'bearish', icon: 'üåô' });
        }
    }
    
    // 2 candle patterns
    // Bullish Engulfing: red followed by bigger green
    var lastHeight = last.bot - last.top;
    var prevHeight = prev.bot - prev.top;
    
    if (prev.type === 'red' && last.type === 'green' && lastHeight > prevHeight) {
        patterns.push({ name: 'Bullish Engulfing', type: 'bullish', icon: 'ü´Ç' });
    }
    
    // Bearish Engulfing: green followed by bigger red
    if (prev.type === 'green' && last.type === 'red' && lastHeight > prevHeight) {
        patterns.push({ name: 'Bearish Engulfing', type: 'bearish', icon: 'ü´Ç' });
    }
    
    // Single candle patterns
    // Doji: very small body
    if (lastHeight < 5) {
        patterns.push({ name: 'Doji', type: 'neutral', icon: '‚ûï' });
    }
    
    return patterns;
}

// ===================== PREDICT NEXT MOVE =====================
function predictNext(currentDir, patterns, lastCandles) {
    // Check last 10 candles for trend (not just 3)
    var last10 = lastCandles.slice(-10);
    var last10Green = last10.filter(function(c) { return c.type === 'green'; }).length;
    var last10Red = last10.filter(function(c) { return c.type === 'red'; }).length;
    
    // Pattern-based prediction
    var bullishPatterns = patterns.filter(function(p) { return p.type === 'bullish'; });
    var bearishPatterns = patterns.filter(function(p) { return p.type === 'bearish'; });
    
    var pred = { dir: 'neutral', title: 'WAIT', reason: 'No clear signal', action: 'WAIT', cls: 'wait' };
    
    if (bullishPatterns.length > 0) {
        pred = {
            dir: 'bullish',
            title: 'Likely UP ‚ÜóÔ∏è',
            reason: bullishPatterns[0].name,
            action: 'BUY',
            cls: 'buy'
        };
    } else if (bearishPatterns.length > 0) {
        pred = {
            dir: 'bearish',
            title: 'Likely DOWN ‚ÜòÔ∏è',
            reason: bearishPatterns[0].name,
            action: 'SELL',
            cls: 'sell'
        };
    } else if (last10Green > last10Red) {
        pred = {
            dir: 'bullish',
            title: 'Trend UP ‚ÜóÔ∏è',
            reason: last10Green + ' green vs ' + last10Red + ' red (last 10)',
            action: 'BUY',
            cls: 'buy'
        };
    } else if (last10Red > last10Green) {
        pred = {
            dir: 'bearish',
            title: 'Trend DOWN ‚ÜòÔ∏è',
            reason: last10Red + ' red vs ' + last10Green + ' green (last 10)',
            action: 'SELL',
            cls: 'sell'
        };
    }
    
    return pred;
}

// ===================== RENDER RESULTS =====================
function renderResults(r) {
    var icons = { bullish: 'üìà', bearish: 'üìâ', neutral: 'üìä' };
    var labels = { bullish: 'BULLISH', bearish: 'BEARISH', neutral: 'NEUTRAL' };
    
    var patsHTML = '';
    if (r.patterns.length > 0) {
        r.patterns.forEach(function(p) {
            patsHTML += '<div class="pat-chip ' + p.type + '">' + p.icon + ' ' + p.name + '</div>';
        });
    } else {
        patsHTML = '<div class="no-patterns">No patterns detected</div>';
    }
    
    dataPanel.innerHTML = 
        '<div class="signal-card">' +
            '<div class="signal-icon ' + r.dir + '">' + icons[r.dir] + '</div>' +
            '<div class="signal-info">' +
                '<div class="direction ' + r.dir + '">' + labels[r.dir] + '</div>' +
                '<div class="meta">' + r.greenCount + ' green ¬∑ ' + r.redCount + ' red</div>' +
            '</div>' +
            '<div class="signal-conf">' +
                '<div class="num ' + r.dir + '">' + r.conf + '%</div>' +
                '<div class="lbl">Confidence</div>' +
            '</div>' +
        '</div>' +
        '<div class="prediction ' + r.prediction.dir + '">' +
            '<div class="icon">üéØ</div>' +
            '<div class="text">' +
                '<strong>NEXT: ' + r.prediction.title + '</strong>' +
                '<span>' + r.prediction.reason + '</span>' +
            '</div>' +
            '<div class="action ' + r.prediction.cls + '">' + r.prediction.action + '</div>' +
        '</div>' +
        '<div class="patterns-box">' +
            '<div class="patterns-header">' +
                '<span>üïØÔ∏è Patterns (last 5 candles)</span>' +
                '<span>' + r.patterns.length + ' found</span>' +
            '</div>' +
            '<div class="patterns-chips">' + patsHTML + '</div>' +
        '</div>';
}
</script>
</body>
</html>
